<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      i18n:domain="squidtool"
      metal:use-macro="here/prefs_main_template/macros/master">

  <metal:block fill-slot="top_slot"
               tal:define="dummy python:request.set('disable_border',1)" />

  <body>

    <div metal:fill-slot="prefs_configlet_main"
         tal:define="portal_squid here/portal_squid">

      <h1 i18n:translate="heading_squid">Purge squid caches</h1>

      <a href=""
         class="link-parent"
         tal:attributes="href string: $portal_url/plone_control_panel"
         i18n:domain="plone"
         i18n:translate="label_up_to_plone_setup">
        Up to Plone Setup
      </a>

      <div class="documentDescription"
           i18n:translate="description_squid">
        This tool is used to purge documents on change from one or
        multiple squid caches.
      </div>

      <form action="manage_setSquidSettings"
            tal:condition="python: checkPermission('Manage portal', portal_squid)"
            tal:attributes="action python:portal_squid.absolute_url()+'/manage_setSquidSettings'"
            method="POST">

        <h2 i18n:translate="heading_squid_urls">Portal URLs through squid</h2>
        <p i18n:translate="description_squid_urls">
          Give the server addresses for all squid caches which should
          be contacted for each <strong>PURGE</strong>.  Put the full
          URL of your squid servers here, one per line. Eg:
          'http://www.example.com'. This info will be put in front of
          the document URLs which are relative to the portal
          object. So this means that the URL's you enter here are the
          portal's URLs through the squid server.  Don't forget the
          <em>http://</em> or <em>https://</em> prefix as it is mandatory.
        </p>
        <p>
          <textarea name="urls"><tal:block tal:repeat="url portal_squid/squid_urls"><span tal:replace="url" />
          </tal:block></textarea>
        </p>

        <h2 i18n:translate="heading_urls_to_purge_expr">
          URLs to purge
        </h2>
        <p i18n:translate="description_urls_to_purge_expr">
          Enter an expression for computing the URLs to purge when
          an object is changed.  The expression should return a list
          of relative URLs.  If the expression is left blank,
          portal_url.getRelativeUrl(object) will be used.
        </p>
        <p>
          <input type="text" name="url_expression"
                 tal:attributes="value here/getUrlExpression" />

          <input type="submit" class="context"
                 i18n:attributes="value" i18n:domain="plone"
                 value="Save"/>
        </p>
      </form>

      <form action="manage_pruneUrl"
            tal:condition="python:checkPermission('SquidTool: Purge URL', portal_squid)"
            tal:attributes="action python:portal_squid.absolute_url()+'/manage_pruneUrl'" method="POST">

        <h2 i18n:translate="heading_purge_url">Purge URL</h2>
        <p i18n:translate="description_prune_url">
          Enter a URL which should be PURGEed <em>now</em>. You have
          to give the relative URL relative to your websites root
          URL. Eg: 'somefolder/anotherfolder/somefile'. This fragment
          is added to each of the squid URL's defined above.
        </p>
        <p>
          <input type="text" name="url" size="40" />
        </p>
        <p>
          <input type="submit" class="context"
                 i18n:attributes="value"
                 value="Go!" />
        </p>
      </form>

      <form action="manage_pruneAll"
            tal:condition="python:checkPermission('Manage portal', portal_squid)"
            tal:attributes="action python:portal_squid.absolute_url()+'/manage_pruneAll'"
            method="POST">

        <h2 i18n:translate="heading_prune_all">Purge All indexed Objects</h2>
        <p i18n:translate="description_purge_all">
          Press the button below to purge all objects indexed in the
          portal catalog. <em>This may take some time.</em>
        </p>

        <input type="submit" class="context"
               i18n:attributes="value"
               value="Go!" />
      </form>
    </div>
  </body>
</html>
